{% extends 'base.html' %}

{% block title %}{{ position.ticker }} - EqTrak{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-4">
        <a href="{% url 'portfolio:portfolio_detail' portfolio.portfolio_id %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Portfolio
        </a>
    </div>
    
    <h1>{{ position.ticker }}</h1>
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">Position Details</h5>
                <div class="btn-group">
                    <a href="{% url 'portfolio:position_delete' portfolio.portfolio_id position.position_id %}" class="btn btn-outline-danger">
                        <i class="bi bi-trash"></i> Delete Position
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-2"><strong>Type:</strong> {{ position.get_position_type_display }}</p>
                    <p class="mb-2"><strong>Shares:</strong> {{ position.shares }}</p>
                </div>
                <div class="col-md-6">
                    <p class="mb-2"><strong>Average Price:</strong> {{ portfolio.currency }} {{ position.purchase_price }}</p>
                    <p class="mb-2"><strong>Cost Basis:</strong> {{ portfolio.currency }} {{ position.cost_basis }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">Transactions</h5>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="addTransactionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-plus"></i> Add Transaction
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="addTransactionDropdown">
                        <li><a class="dropdown-item" href="{% url 'portfolio:transaction_create' portfolio.portfolio_id position.position_id %}?type=BUY">Buy</a></li>
                        <li><a class="dropdown-item" href="{% url 'portfolio:transaction_create' portfolio.portfolio_id position.position_id %}?type=SELL">Sell</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'portfolio:transaction_create' portfolio.portfolio_id position.position_id %}?type=DIVIDEND">Dividend</a></li>
                        <li><a class="dropdown-item" href="{% url 'portfolio:transaction_create' portfolio.portfolio_id position.position_id %}?type=SPLIT">Stock Split</a></li>
                    </ul>
                </div>
            </div>

            {% if transactions %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Fees</th>
                                <th>Total</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in transactions %}
                                <tr>
                                    <td>{{ transaction.date }}</td>
                                    <td>{{ transaction.get_transaction_type_display }}</td>
                                    <td>{{ transaction.quantity }}</td>
                                    <td>{{ portfolio.currency }} {{ transaction.price }}</td>
                                    <td>{{ portfolio.currency }} {{ transaction.fees }}</td>
                                    <td>{{ portfolio.currency }} {{ transaction.total_amount }}</td>
                                    <td>{{ transaction.get_status_display }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-secondary">
                                <td colspan="2"><strong>Totals</strong></td>
                                <td>{{ position.shares }}</td>
                                <td>{{ portfolio.currency }} {{ position.purchase_price }}</td>
                                <td>-</td>
                                <td>{{ portfolio.currency }} {{ position.cost_basis }}</td>
                                <td>-</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-4">
                    <p class="text-muted">No transactions found for this position.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 